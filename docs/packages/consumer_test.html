<!DOCTYPE html>
<!--
 Copyright 2021 Red Hat, Inc

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<html>
<head>
<title>consumer_test.go</title>
<meta charset="utf-8"/>
<style type="text/css">body {
    background: rgb(225, 225, 225);
    margin: 0px;
    padding: 0px;
}

#docgo p {
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 15px;
    margin-left: 0px;
}

#docgo div {
    display: inline;
}

#docgo #background {
    position: fixed;
    top: 0; left: 525px; right: 0; bottom: 0;
    background: rgb(47, 47, 47);
    border-left: 1px solid #e5e5ee;
    z-index: -1;
}

#docgo .keyword {
    color: rgb(250, 200, 100);
}

#docgo .literal {
    color: rgb(140, 190, 100);
}

#docgo .ident {
    color: white;
}

#docgo .operator {
    color: white;
}

#docgo .comment {
}

#docgo h1, h2, h3, h4, h5 {
    text-align: left;
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 15px;
    margin-left: 0px;
}

#docgo h1 {
    margin-top: 40px;
}

#docgo .doc {
    vertical-align: top;
    font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;
    font-size: 15px;
    line-height: 22px;
    color: black;
    min-width: 450px;
    max-width: 450px;
    padding-top: 10px;
    padding-right: 25px;
    padding-bottom: 1px;
    padding-left: 50px;
    overflow-x: hidden;
}

#docgo .code {
    min-width: 650px;
    max-width: 650px;
    padding-left: 25px;
    padding-right: 15px;
    border-left: 1px;
    overflow-x: hidden;
    vertical-align: top;
}

#docgo .code pre code  {
    font-size: 12px;
    line-height: 18px;
    font-family: Menlo, Monaco, Consolas, "Lucida Console", monospace;
    color: rgb(120, 120, 120);
}
</style>
</head>
<body>
<div id="docgo">
  <div id="background"></div>
  <table>
    <thead><tr><th class="doc"><h1>consumer_test.go</h1></th><th class="code"></th></tr></thead>
    <tbody>
      
      <tr class="section">
	<td class="doc"></td>
	<td class="code"><pre><code><div class="comment">/*
Copyright Â© 2021 Red Hat, Inc.

Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/</div>

<div class="keyword">package</div> <div class="ident">main_test</div><div class="operator"></div>

<div class="keyword">import</div> <div class="operator">(</div>
	<div class="literal">&#34;context&#34;</div><div class="operator"></div>
	<div class="literal">&#34;fmt&#34;</div><div class="operator"></div>
	<div class="literal">&#34;testing&#34;</div><div class="operator"></div>
	<div class="literal">&#34;time&#34;</div><div class="operator"></div>

	<div class="literal">&#34;github.com/Shopify/sarama&#34;</div><div class="operator"></div>
	<div class="literal">&#34;github.com/stretchr/testify/assert&#34;</div><div class="operator"></div>

	<div class="ident">main</div> <div class="literal">&#34;github.com/RedHatInsights/ccx-notification-writer&#34;</div><div class="operator"></div>
<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>Variables used by unit tests</p>
</td>
	<td class="code"><pre><code><div class="keyword">var</div> <div class="operator">(</div>
	<div class="ident">ExpectedOrgID</div>         <div class="operator">=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">(</div><div class="literal">1</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">ExpectedAccountNumber</div> <div class="operator">=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">AccountNumber</div><div class="operator">(</div><div class="literal">1234</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">ExpectedClusterName</div>   <div class="operator">=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">(</div><div class="literal">&#34;84f7eedc-0dd8-49cd-9d4d-f6646df3a5bc&#34;</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">LastCheckedAt</div>         <div class="operator">=</div> <div class="ident">time</div><div class="operator">.</div><div class="ident">Unix</div><div class="operator">(</div><div class="literal">25</div><div class="operator">,</div> <div class="literal">0</div><div class="operator">)</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">ConsumerReport</div> <div class="operator">=</div> <div class="literal">`{
		&#34;fingerprints&#34;: [],
		&#34;info&#34;: [],
		&#34;reports&#34;: [],
		&#34;skips&#34;: [],
		&#34;system&#34;: {}
	}`</div><div class="operator"></div>
<div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestNewConsumerBadBroker function checks the consumer creation by
using a non accessible Kafka broker.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestNewConsumerBadBroker</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">const</div> <div class="ident">expectedErr</div> <div class="operator">=</div> <div class="literal">&#34;kafka: client has run out of available brokers to talk to (Is your cluster reachable?)&#34;</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>invalid broker configuration</p>
</td>
	<td class="code"><pre><code>	<div class="keyword">var</div> <div class="ident">brokerConfiguration</div> <div class="operator">=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">BrokerConfiguration</div><div class="operator">{</div>
		<div class="ident">Address</div><div class="operator">:</div> <div class="literal">&#34;&#34;</div><div class="operator">,</div>
		<div class="ident">Topic</div><div class="operator">:</div>   <div class="literal">&#34;whatever&#34;</div><div class="operator">,</div>
		<div class="ident">Group</div><div class="operator">:</div>   <div class="literal">&#34;whatever&#34;</div><div class="operator">,</div>
		<div class="ident">Enabled</div><div class="operator">:</div> <div class="ident">true</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>dummy storage not really useable as the driver is not specified</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyStorage</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">NewFromConnection</div><div class="operator">(</div><div class="ident">nil</div><div class="operator">,</div> <div class="literal">1</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to construct new consumer</p>
</td>
	<td class="code"><pre><code>	<div class="ident">mockConsumer</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">NewConsumer</div><div class="operator">(</div><div class="ident">brokerConfiguration</div><div class="operator">,</div> <div class="ident">dummyStorage</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check that error is really reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">,</div> <div class="ident">expectedErr</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>test the return value</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div>
		<div class="ident">t</div><div class="operator">,</div>
		<div class="operator">(</div><div class="operator">*</div><div class="ident">main</div><div class="operator">.</div><div class="ident">KafkaConsumer</div><div class="operator">)</div><div class="operator">(</div><div class="ident">nil</div><div class="operator">)</div><div class="operator">,</div>
		<div class="ident">mockConsumer</div><div class="operator">,</div>
		<div class="literal">&#34;consumer.New should return nil instead of Consumer implementation&#34;</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestNewConsumerLocalBroker function checks the consumer creation by using a
non accessible Kafka broker. This test assumes there is no local Kafka
instance currently running</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestNewConsumerLocalBroker</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
	<div class="keyword">const</div> <div class="ident">expectedErr</div> <div class="operator">=</div> <div class="literal">&#34;kafka: client has run out of available brokers to talk to (Is your cluster reachable?)&#34;</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>valid broker configuration for local Kafka instance</p>
</td>
	<td class="code"><pre><code>	<div class="keyword">var</div> <div class="ident">brokerConfiguration</div> <div class="operator">=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">BrokerConfiguration</div><div class="operator">{</div>
		<div class="ident">Address</div><div class="operator">:</div> <div class="literal">&#34;localhost:9092&#34;</div><div class="operator">,</div>
		<div class="ident">Topic</div><div class="operator">:</div>   <div class="literal">&#34;platform.notifications.ingress&#34;</div><div class="operator">,</div>
		<div class="ident">Group</div><div class="operator">:</div>   <div class="literal">&#34;&#34;</div><div class="operator">,</div>
		<div class="ident">Enabled</div><div class="operator">:</div> <div class="ident">true</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>dummy storage not really useable as the driver is not specified</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyStorage</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">NewFromConnection</div><div class="operator">(</div><div class="ident">nil</div><div class="operator">,</div> <div class="literal">1</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to construct new consumer</p>
</td>
	<td class="code"><pre><code>	<div class="ident">mockConsumer</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">NewConsumer</div><div class="operator">(</div><div class="ident">brokerConfiguration</div><div class="operator">,</div> <div class="ident">dummyStorage</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check that error is really reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">,</div> <div class="ident">expectedErr</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>test the return value</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div>
		<div class="ident">t</div><div class="operator">,</div>
		<div class="operator">(</div><div class="operator">*</div><div class="ident">main</div><div class="operator">.</div><div class="ident">KafkaConsumer</div><div class="operator">)</div><div class="operator">(</div><div class="ident">nil</div><div class="operator">)</div><div class="operator">,</div>
		<div class="ident">mockConsumer</div><div class="operator">,</div>
		<div class="literal">&#34;consumer.New should return nil instead of Consumer implementation&#34;</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestParseEmptyMessage checks how empty message is handled by
consumer.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestParseEmptyMessage</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>empty message to be parsed</p>
</td>
	<td class="code"><pre><code>	<div class="keyword">const</div> <div class="ident">emptyMessage</div> <div class="operator">=</div> <div class="literal">&#34;&#34;</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to parse the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">ParseMessage</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">emptyMessage</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for error - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">,</div> <div class="literal">&#34;unexpected end of JSON input&#34;</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestParseMessageWithWrongContent checks how message with wrong
(unexpected) content is handled by consumer.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestParseMessageWithWrongContent</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>JSON-encoded message with unexpected content</p>
</td>
	<td class="code"><pre><code>	<div class="keyword">const</div> <div class="ident">message</div> <div class="operator">=</div> <div class="literal">`{&#34;this&#34;:&#34;is&#34;, &#34;not&#34;:&#34;expected content&#34;}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to parse the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">ParseMessage</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">message</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for error - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Error</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Contains</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">.</div><div class="ident">Error</div><div class="operator">(</div><div class="operator">)</div><div class="operator">,</div> <div class="literal">&#34;missing required attribute&#34;</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestParseMessageWithImproperJSON checks how message with wrong
content which is not parseable as JSON is processed.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestParseMessageWithImproperJSON</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>message not in JSON format</p>
</td>
	<td class="code"><pre><code>	<div class="keyword">const</div> <div class="ident">message</div> <div class="operator">=</div> <div class="literal">`&#34;this_is_not_json_dude&#34;`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to parse the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">ParseMessage</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">message</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for error - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div>
		<div class="ident">t</div><div class="operator">,</div>
		<div class="ident">err</div><div class="operator">,</div>
		<div class="literal">&#34;json: cannot unmarshal string into Go value of type main.IncomingMessage&#34;</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestParseProperMessage checks the parsing of properly declared
message.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestParseProperMessage</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>message in JSON format with all required attributes</p>
</td>
	<td class="code"><pre><code>	<div class="ident">ConsumerMessage</div> <div class="operator">:=</div> <div class="literal">`{
		&#34;OrgID&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedOrgID</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;AccountNumber&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedAccountNumber</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;ClusterName&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">ExpectedClusterName</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;,
		&#34;Report&#34;:`</div> <div class="operator">&#43;</div> <div class="ident">ConsumerReport</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;LastChecked&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;
	}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to parse the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">message</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">ParseMessage</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">ConsumerMessage</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for error - it should not be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check returned values</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">OrgID</div><div class="operator">(</div><div class="literal">1</div><div class="operator">)</div><div class="operator">,</div> <div class="operator">*</div><div class="ident">message</div><div class="operator">.</div><div class="ident">Organization</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">ExpectedClusterName</div><div class="operator">,</div> <div class="operator">*</div><div class="ident">message</div><div class="operator">.</div><div class="ident">ClusterName</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">ExpectedAccountNumber</div><div class="operator">,</div> <div class="operator">*</div><div class="ident">message</div><div class="operator">.</div><div class="ident">AccountNumber</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestParseProperMessageWrongOrgID checks the parsing of message
with wrong organization ID.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestParseProperMessageWrongOrgID</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>message with wrong organization ID attribute.</p>
</td>
	<td class="code"><pre><code>	<div class="ident">message</div> <div class="operator">:=</div> <div class="literal">`{
		&#34;OrgID&#34;: &#34;foobar&#34;,
		&#34;AccountNumber&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedAccountNumber</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;ClusterName&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">ExpectedClusterName</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;,
		&#34;Report&#34;:`</div> <div class="operator">&#43;</div> <div class="ident">ConsumerReport</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;LastChecked&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;
	}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to parse the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">ParseMessage</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">message</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for error - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div>
		<div class="ident">t</div><div class="operator">,</div>
		<div class="ident">err</div><div class="operator">,</div>
		<div class="literal">&#34;json: cannot unmarshal string into Go struct field IncomingMessage.OrgID of type main.OrgID&#34;</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestParseProperMessageWrongAccountNumber checks the parsing of message
with wrong organization ID.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestParseProperMessageWrongAccountNumber</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>message with wrong account number attribute.</p>
</td>
	<td class="code"><pre><code>	<div class="ident">message</div> <div class="operator">:=</div> <div class="literal">`{
		&#34;OrgID&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedOrgID</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;AccountNumber&#34;: &#34;foobar&#34;,
		&#34;ClusterName&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">ExpectedClusterName</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;,
		&#34;Report&#34;:`</div> <div class="operator">&#43;</div> <div class="ident">ConsumerReport</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;LastChecked&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;
	}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to parse the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">ParseMessage</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">message</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for error - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div>
		<div class="ident">t</div><div class="operator">,</div>
		<div class="ident">err</div><div class="operator">,</div>
		<div class="literal">&#34;json: cannot unmarshal string into Go struct field IncomingMessage.AccountNumber of type main.AccountNumber&#34;</div><div class="operator">,</div>
	<div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestParseProperMessageWrongClusterName checks the parsing of message
with wrong cluster name.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestParseProperMessageWrongClusterName</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>message with wrong cluster name</p>
</td>
	<td class="code"><pre><code>	<div class="ident">message</div> <div class="operator">:=</div> <div class="literal">`{
		&#34;OrgID&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedOrgID</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;AccountNumber&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedAccountNumber</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;ClusterName&#34;: &#34;this is not an UUID&#34;,
		&#34;Report&#34;:`</div> <div class="operator">&#43;</div> <div class="ident">ConsumerReport</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;LastChecked&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;
	}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to parse the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">ParseMessage</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">message</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for error - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">,</div> <div class="literal">&#34;cluster name is not a UUID&#34;</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestParseMessageWithoutOrgID checks the parsing of improperly
declared message - OrgID attribute is missing.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestParseMessageWithoutOrgID</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>message without OrgID attribute</p>
</td>
	<td class="code"><pre><code>	<div class="ident">ConsumerMessage</div> <div class="operator">:=</div> <div class="literal">`{
		&#34;AccountNumber&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedAccountNumber</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;ClusterName&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">ExpectedClusterName</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;,
		&#34;Report&#34;:`</div> <div class="operator">&#43;</div> <div class="ident">ConsumerReport</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;LastChecked&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;
	}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to parse the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">ParseMessage</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">ConsumerMessage</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for error - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">,</div> <div class="literal">&#34;missing required attribute &#39;OrgID&#39;&#34;</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestParseMessageWithoutAccountNumber checks the parsing of improperly
declared message - AccountNumber attribute is missing.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestParseMessageWithoutAccountNumber</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>message without AccountNumber attribute</p>
</td>
	<td class="code"><pre><code>	<div class="ident">ConsumerMessage</div> <div class="operator">:=</div> <div class="literal">`{
		&#34;OrgID&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedOrgID</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;ClusterName&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">ExpectedClusterName</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;,
		&#34;Report&#34;:`</div> <div class="operator">&#43;</div> <div class="ident">ConsumerReport</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;LastChecked&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;
	}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to parse the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">ParseMessage</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">ConsumerMessage</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for error - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">,</div> <div class="literal">&#34;missing required attribute &#39;AccountNumber&#39;&#34;</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestParseMessageWithoutClusterName checks the parsing of improperly
declared message - ClusterName attribute is missing.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestParseMessageWithoutClusterName</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>message without ClusterName attribute</p>
</td>
	<td class="code"><pre><code>	<div class="ident">ConsumerMessage</div> <div class="operator">:=</div> <div class="literal">`{
		&#34;OrgID&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedOrgID</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;AccountNumber&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedAccountNumber</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;Report&#34;:`</div> <div class="operator">&#43;</div> <div class="ident">ConsumerReport</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;LastChecked&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;
	}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to parse the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">ParseMessage</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">ConsumerMessage</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for error - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">,</div> <div class="literal">&#34;missing required attribute &#39;ClusterName&#39;&#34;</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestParseMessageWithoutReport checks the parsing of improperly
declared message - Report attribute is missing.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestParseMessageWithoutReport</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>message without Report attribute</p>
</td>
	<td class="code"><pre><code>	<div class="ident">ConsumerMessage</div> <div class="operator">:=</div> <div class="literal">`{
		&#34;OrgID&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedOrgID</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;AccountNumber&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedAccountNumber</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;ClusterName&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">ExpectedClusterName</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;,
		&#34;LastChecked&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;
	}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to parse the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">ParseMessage</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">ConsumerMessage</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for error - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">,</div> <div class="literal">&#34;missing required attribute &#39;Report&#39;&#34;</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestParseMessageEmptyReport checks the parsing of improperly
declared message - report attribute is empty.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestParseMessageEmptyReport</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>message with empty Report attribute</p>
</td>
	<td class="code"><pre><code>	<div class="ident">ConsumerMessage</div> <div class="operator">:=</div> <div class="literal">`{
		&#34;OrgID&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedOrgID</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;AccountNumber&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedAccountNumber</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;ClusterName&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">ExpectedClusterName</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;,
		&#34;Report&#34;: {},
		&#34;LastChecked&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;
	}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to parse the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">ParseMessage</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">ConsumerMessage</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for error - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">,</div> <div class="literal">&#34;Improper report structure, missing key fingerprints&#34;</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestParseMessageNullReport checks the parsing of improperly
declared message - Report attribute is null.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestParseMessageNullReport</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>message with empty Report attribute</p>
</td>
	<td class="code"><pre><code>	<div class="ident">ConsumerMessage</div> <div class="operator">:=</div> <div class="literal">`{
		&#34;OrgID&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedOrgID</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;AccountNumber&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedAccountNumber</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;ClusterName&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">ExpectedClusterName</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;,
		&#34;Report&#34;: null,
		&#34;LastChecked&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;
	}`</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to parse the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">ParseMessage</div><div class="operator">(</div><div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">ConsumerMessage</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for error - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">,</div> <div class="literal">&#34;missing required attribute &#39;Report&#39;&#34;</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>NewDummyConsumer function constructs new instance of (not running)
KafkaConsumer.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">NewDummyConsumer</div><div class="operator">(</div><div class="ident">s</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">Storage</div><div class="operator">)</div> <div class="operator">*</div><div class="ident">main</div><div class="operator">.</div><div class="ident">KafkaConsumer</div> <div class="operator">{</div>
	<div class="ident">brokerCfg</div> <div class="operator">:=</div> <div class="ident">main</div><div class="operator">.</div><div class="ident">BrokerConfiguration</div><div class="operator">{</div>
		<div class="ident">Address</div><div class="operator">:</div> <div class="literal">&#34;localhost:1234&#34;</div><div class="operator">,</div>
		<div class="ident">Topic</div><div class="operator">:</div>   <div class="literal">&#34;topic&#34;</div><div class="operator">,</div>
		<div class="ident">Group</div><div class="operator">:</div>   <div class="literal">&#34;group&#34;</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>
	<div class="keyword">return</div> <div class="operator">&amp;</div><div class="ident">main</div><div class="operator">.</div><div class="ident">KafkaConsumer</div><div class="operator">{</div>
		<div class="ident">Configuration</div><div class="operator">:</div> <div class="ident">brokerCfg</div><div class="operator">,</div>
		<div class="ident">Storage</div><div class="operator">:</div>       <div class="ident">s</div><div class="operator">,</div>
		<div class="ident">Ready</div><div class="operator">:</div>         <div class="ident">make</div><div class="operator">(</div><div class="keyword">chan</div> <div class="ident">bool</div><div class="operator">)</div><div class="operator">,</div>
	<div class="operator">}</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestProcessEmptyMessage check the behaviour of function ProcessMessage with
empty message on input.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestProcessEmptyMessage</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct mock storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">mockStorage</div> <div class="operator">:=</div> <div class="ident">NewMockStorage</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct dummy consumer</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div> <div class="operator">:=</div> <div class="ident">NewDummyConsumer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">mockStorage</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>counter checks</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfSuccessfullyConsumedMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfErrorsConsumingMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare an empty message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">message</div> <div class="operator">:=</div> <div class="ident">sarama</div><div class="operator">.</div><div class="ident">ConsumerMessage</div><div class="operator">{</div><div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to process the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">ProcessMessage</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">message</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for errors - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">,</div> <div class="literal">&#34;unexpected end of JSON input&#34;</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>nothing should be written into storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="literal">0</div><div class="operator">,</div> <div class="ident">mockStorage</div><div class="operator">.</div><div class="ident">writeReportCalled</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>counter checks</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfSuccessfullyConsumedMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfErrorsConsumingMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestProcessMessageWithWrongDateFormat check the behaviour of function
ProcessMessage with message with wrong date.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestProcessMessageWithWrongDateFormat</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct mock storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">mockStorage</div> <div class="operator">:=</div> <div class="ident">NewMockStorage</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct dummy consumer</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div> <div class="operator">:=</div> <div class="ident">NewDummyConsumer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">mockStorage</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>counter checks</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfSuccessfullyConsumedMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfErrorsConsumingMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare a message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">message</div> <div class="operator">:=</div> <div class="ident">sarama</div><div class="operator">.</div><div class="ident">ConsumerMessage</div><div class="operator">{</div><div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>fill in a message payload</p>
</td>
	<td class="code"><pre><code>	<div class="ident">ConsumerMessage</div> <div class="operator">:=</div> <div class="literal">`{
		&#34;OrgID&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedOrgID</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;AccountNumber&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedAccountNumber</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;ClusterName&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">ExpectedClusterName</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;,
		&#34;Report&#34;:`</div> <div class="operator">&#43;</div> <div class="ident">ConsumerReport</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;LastChecked&#34;: &#34;2020.01.23 16:15:59&#34;
	}`</div><div class="operator"></div>
	<div class="ident">message</div><div class="operator">.</div><div class="ident">Value</div> <div class="operator">=</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">ConsumerMessage</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to process the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">ProcessMessage</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">message</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for errors - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">,</div> <div class="literal">&#34;parsing time \&#34;2020.01.23 16:15:59\&#34; as \&#34;2006-01-02T15:04:05.999999999Z07:00\&#34;: cannot parse \&#34;.01.23 16:15:59\&#34; as \&#34;-\&#34;&#34;</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>nothing should be written into storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="literal">0</div><div class="operator">,</div> <div class="ident">mockStorage</div><div class="operator">.</div><div class="ident">writeReportCalled</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>counter checks</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfSuccessfullyConsumedMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfErrorsConsumingMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestProcessMessageFromFuture check the behaviour of function ProcessMessage
with message with wrong date.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestProcessMessageFromFuture</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct mock storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">mockStorage</div> <div class="operator">:=</div> <div class="ident">NewMockStorage</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct dummy consumer</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div> <div class="operator">:=</div> <div class="ident">NewDummyConsumer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">mockStorage</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>counter checks</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfSuccessfullyConsumedMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfErrorsConsumingMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare a message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">message</div> <div class="operator">:=</div> <div class="ident">sarama</div><div class="operator">.</div><div class="ident">ConsumerMessage</div><div class="operator">{</div><div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>fill in a message payload</p>
</td>
	<td class="code"><pre><code>	<div class="ident">ConsumerMessage</div> <div class="operator">:=</div> <div class="literal">`{
		&#34;OrgID&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedOrgID</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;AccountNumber&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedAccountNumber</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;ClusterName&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">ExpectedClusterName</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;,
		&#34;Report&#34;:`</div> <div class="operator">&#43;</div> <div class="ident">ConsumerReport</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;LastChecked&#34;: &#34;2099-01-01T23:59:59.999999999Z&#34;
	}`</div><div class="operator"></div>
	<div class="ident">message</div><div class="operator">.</div><div class="ident">Value</div> <div class="operator">=</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">ConsumerMessage</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to process the message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">ProcessMessage</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">message</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for errors - it should be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">EqualError</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">,</div> <div class="literal">&#34;Got a message from the future&#34;</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>nothing should be written into storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="literal">0</div><div class="operator">,</div> <div class="ident">mockStorage</div><div class="operator">.</div><div class="ident">writeReportCalled</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>counter checks</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfSuccessfullyConsumedMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfErrorsConsumingMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestProcessCorrectMessage check the behaviour of function ProcessMessage for
correct message.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestProcessCorrectMessage</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct mock storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">mockStorage</div> <div class="operator">:=</div> <div class="ident">NewMockStorage</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct dummy consumer</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div> <div class="operator">:=</div> <div class="ident">NewDummyConsumer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">mockStorage</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>counter checks</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfSuccessfullyConsumedMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfErrorsConsumingMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>prepare a message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">message</div> <div class="operator">:=</div> <div class="ident">sarama</div><div class="operator">.</div><div class="ident">ConsumerMessage</div><div class="operator">{</div><div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>fill in a message payload</p>
</td>
	<td class="code"><pre><code>	<div class="ident">ConsumerMessage</div> <div class="operator">:=</div> <div class="literal">`{
		&#34;OrgID&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedOrgID</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;AccountNumber&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedAccountNumber</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;ClusterName&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">ExpectedClusterName</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;,
		&#34;Report&#34;:`</div> <div class="operator">&#43;</div> <div class="ident">ConsumerReport</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;LastChecked&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;
	}`</div><div class="operator"></div>
	<div class="ident">message</div><div class="operator">.</div><div class="ident">Value</div> <div class="operator">=</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">ConsumerMessage</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>message is correct -&gt; one record should be written into the database</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">err</div> <div class="operator">:=</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">ProcessMessage</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">message</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>check for error - it should not be reported</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>one record should be written into the storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="literal">1</div><div class="operator">,</div> <div class="ident">mockStorage</div><div class="operator">.</div><div class="ident">writeReportCalled</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>counter checks</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfSuccessfullyConsumedMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfErrorsConsumingMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestConsumerSetup function checks the method KafkaConsumer.Cleanup().</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestConsumerSetup</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct mock storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">mockStorage</div> <div class="operator">:=</div> <div class="ident">NewMockStorage</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct dummy consumer</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div> <div class="operator">:=</div> <div class="ident">NewDummyConsumer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">mockStorage</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>channel that needs to be closed in Setup</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">Ready</div> <div class="operator">=</div> <div class="ident">make</div><div class="operator">(</div><div class="keyword">chan</div> <div class="ident">bool</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to setup the consumer (without consumer group)</p>
</td>
	<td class="code"><pre><code>	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">Setup</div><div class="operator">(</div><div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>and check for any error</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestConsumerCleanup function checks the method KafkaConsumer.Cleanup().</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestConsumerCleanup</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct mock storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">mockStorage</div> <div class="operator">:=</div> <div class="ident">NewMockStorage</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct dummy consumer</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div> <div class="operator">:=</div> <div class="ident">NewDummyConsumer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">mockStorage</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to cleanup the consumer (without consumer group)</p>
</td>
	<td class="code"><pre><code>	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">Cleanup</div><div class="operator">(</div><div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>and check for any error</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestConsumerClose function checks the method KafkaConsumer.Close().</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestConsumerClose</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct mock storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">mockStorage</div> <div class="operator">:=</div> <div class="ident">NewMockStorage</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct dummy consumer</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div> <div class="operator">:=</div> <div class="ident">NewDummyConsumer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">mockStorage</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to close the consumer (without consumer group)</p>
</td>
	<td class="code"><pre><code>	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">Close</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>and check for any error</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestConsumerCloseCancel function checks the method KafkaConsumer.Close().</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestConsumerCloseCancel</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct mock storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">mockStorage</div> <div class="operator">:=</div> <div class="ident">NewMockStorage</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct dummy consumer</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div> <div class="operator">:=</div> <div class="ident">NewDummyConsumer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">mockStorage</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>setup cancel hook</p>
</td>
	<td class="code"><pre><code>	<div class="ident">_</div><div class="operator">,</div> <div class="ident">cancel</div> <div class="operator">:=</div> <div class="ident">context</div><div class="operator">.</div><div class="ident">WithCancel</div><div class="operator">(</div><div class="ident">context</div><div class="operator">.</div><div class="ident">Background</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">Cancel</div> <div class="operator">=</div> <div class="ident">cancel</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>try to close the consumer (without consumer group)</p>
</td>
	<td class="code"><pre><code>	<div class="ident">err</div> <div class="operator">:=</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">Close</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>and check for any error</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Nil</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">err</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHandleNilMessage function checks the method
KafkaConsumer.HandleMessage() for nil input.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHandleNilMessage</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct mock storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">mockStorage</div> <div class="operator">:=</div> <div class="ident">NewMockStorage</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct dummy consumer</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div> <div class="operator">:=</div> <div class="ident">NewDummyConsumer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">mockStorage</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>nil message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">HandleMessage</div><div class="operator">(</div><div class="ident">nil</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHandleEmptyMessage function checks the method
KafkaConsumer.HandleMessage() for empty message value.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHandleEmptyMessage</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct mock storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">mockStorage</div> <div class="operator">:=</div> <div class="ident">NewMockStorage</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct dummy consumer</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div> <div class="operator">:=</div> <div class="ident">NewDummyConsumer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">mockStorage</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">message</div> <div class="operator">:=</div> <div class="ident">sarama</div><div class="operator">.</div><div class="ident">ConsumerMessage</div><div class="operator">{</div><div class="operator">}</div><div class="operator"></div>

	<div class="ident">message</div><div class="operator">.</div><div class="ident">Value</div> <div class="operator">=</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="literal">&#34;&#34;</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>counter checks</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfSuccessfullyConsumedMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfErrorsConsumingMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>empty message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">HandleMessage</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">message</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>counter checks</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfSuccessfullyConsumedMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">1</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfErrorsConsumingMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>TestHandleCorrectMessage function checks the method
KafkaConsumer.HandleMessage() for correct input.</p>
</td>
	<td class="code"><pre><code><div class="keyword">func</div> <div class="ident">TestHandleCorrectMessage</div><div class="operator">(</div><div class="ident">t</div> <div class="operator">*</div><div class="ident">testing</div><div class="operator">.</div><div class="ident">T</div><div class="operator">)</div> <div class="operator">{</div>
</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct mock storage</p>
</td>
	<td class="code"><pre><code>	<div class="ident">mockStorage</div> <div class="operator">:=</div> <div class="ident">NewMockStorage</div><div class="operator">(</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>construct dummy consumer</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div> <div class="operator">:=</div> <div class="ident">NewDummyConsumer</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">mockStorage</div><div class="operator">)</div><div class="operator"></div>

	<div class="ident">message</div> <div class="operator">:=</div> <div class="ident">sarama</div><div class="operator">.</div><div class="ident">ConsumerMessage</div><div class="operator">{</div><div class="operator">}</div><div class="operator"></div>
	<div class="ident">value</div> <div class="operator">:=</div> <div class="literal">`{
		&#34;OrgID&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedOrgID</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;AccountNumber&#34;: `</div> <div class="operator">&#43;</div> <div class="ident">fmt</div><div class="operator">.</div><div class="ident">Sprint</div><div class="operator">(</div><div class="ident">ExpectedAccountNumber</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;ClusterName&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">string</div><div class="operator">(</div><div class="ident">ExpectedClusterName</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;,
		&#34;Report&#34;:`</div> <div class="operator">&#43;</div> <div class="ident">ConsumerReport</div> <div class="operator">&#43;</div> <div class="literal">`,
		&#34;LastChecked&#34;: &#34;`</div> <div class="operator">&#43;</div> <div class="ident">LastCheckedAt</div><div class="operator">.</div><div class="ident">UTC</div><div class="operator">(</div><div class="operator">)</div><div class="operator">.</div><div class="ident">Format</div><div class="operator">(</div><div class="ident">time</div><div class="operator">.</div><div class="ident">RFC3339</div><div class="operator">)</div> <div class="operator">&#43;</div> <div class="literal">`&#34;
	}`</div><div class="operator"></div>

	<div class="ident">message</div><div class="operator">.</div><div class="ident">Value</div> <div class="operator">=</div> <div class="operator">[</div><div class="operator">]</div><div class="ident">byte</div><div class="operator">(</div><div class="ident">value</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>counter checks</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfSuccessfullyConsumedMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfErrorsConsumingMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>correct message</p>
</td>
	<td class="code"><pre><code>	<div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">HandleMessage</div><div class="operator">(</div><div class="operator">&amp;</div><div class="ident">message</div><div class="operator">)</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
      <tr class="section">
	<td class="doc"><p>counter checks</p>
</td>
	<td class="code"><pre><code>	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">1</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfSuccessfullyConsumedMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
	<div class="ident">assert</div><div class="operator">.</div><div class="ident">Equal</div><div class="operator">(</div><div class="ident">t</div><div class="operator">,</div> <div class="ident">uint64</div><div class="operator">(</div><div class="literal">0</div><div class="operator">)</div><div class="operator">,</div> <div class="ident">dummyConsumer</div><div class="operator">.</div><div class="ident">GetNumberOfErrorsConsumingMessages</div><div class="operator">(</div><div class="operator">)</div><div class="operator">)</div><div class="operator"></div>
<div class="operator">}</div><div class="operator"></div>

</code></pre></td>
      </tr>
      
    </tbody>
  </table>
</div>
</body>
</html>
