Feature: Basic set of smoke tests - checks if all required tools are available and all services are running. # features/smoketests.feature:1

  Scenario: Check if CCX Notification Writer application is available  # features/smoketests.feature:4
    Given the system is in default state                               # features/steps/common.py:23
    When I look for executable file ccx-notification-writer            # features/steps/common.py:29
    Then I should find that file on PATH                               # features/steps/common.py:36

  Scenario: Check if Kafkacat utility is available  # features/smoketests.feature:10
    Given the system is in default state            # features/steps/common.py:23
    When I look for executable file kafkacat        # features/steps/common.py:29
    Then I should find that file on PATH            # features/steps/common.py:36

  Scenario: Check if jps utility is available  # features/smoketests.feature:16
    Given the system is in default state       # features/steps/common.py:23
    When I look for executable file jps        # features/steps/common.py:29
    Then I should find that file on PATH       # features/steps/common.py:36

  Scenario: Check if Postgres database is available                                   # features/smoketests.feature:22
    Given Postgres is running                                                         # features/steps/database.py:25
    When I connect to database named postgres as user postgres with password postgres # features/steps/database.py:39
    Then I should be able to connect to such database                                 # features/steps/database.py:46
    When I close database connection                                                  # features/steps/database.py:52
    Then I should be disconnected                                                     # features/steps/database.py:59

  Scenario: Check if CCX Notification Writer database can be reached                         # features/smoketests.feature:30
    Given Postgres is running                                                                # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres # features/steps/database.py:65
    When I close database connection                                                         # features/steps/database.py:52
    Then I should be disconnected                                                            # features/steps/database.py:59

  Scenario: Check if ZooKeeper is running locally                                                  # features/smoketests.feature:37
    Given the system is in default state                                                           # features/steps/common.py:23
    When I retrieve a list of all applications running under JVM                                   # features/steps/jps.py:23
    Then I should find the following application org.apache.zookeeper.server.quorum.QuorumPeerMain # features/steps/jps.py:58

  Scenario: Check if Kafka broker is running locally             # features/smoketests.feature:43
    Given the system is in default state                         # features/steps/common.py:23
    When I retrieve a list of all applications running under JVM # features/steps/jps.py:23
    Then I should find the following application kafka.Kafka     # features/steps/jps.py:58

  Scenario: Check if Kafka broker is running on expected port            # features/smoketests.feature:49
    Given the system is in default state                                 # features/steps/common.py:23
    When I retrieve metadata from Kafka broker running on localhost:9092 # features/steps/kafka.py:25
    Then I should find at least one available broker                     # features/steps/kafka.py:55

Feature: Check command line options provided by CCX Notification Writer # features/cli_flags.feature:1

  Scenario: Check if CCX Notification Writer displays help message             # features/cli_flags.feature:4
    Given the system is in default state                                       # features/steps/common.py:23
    When I start the CCX Notification Writer with the --help command line flag # features/steps/writer.py:51
    Then I should see help messages displayed on standard output               # features/steps/writer.py:62

  Scenario: Check if CCX Notification Writer displays version info                # features/cli_flags.feature:10
    Given the system is in default state                                          # features/steps/common.py:23
    When I start the CCX Notification Writer with the --version command line flag # features/steps/writer.py:51
    Then I should see version info displayed on standard output                   # features/steps/writer.py:106

  Scenario: Check if CCX Notification Writer displays authors                     # features/cli_flags.feature:16
    Given the system is in default state                                          # features/steps/common.py:23
    When I start the CCX Notification Writer with the --authors command line flag # features/steps/writer.py:51
    Then I should see info about authors displayed on standard output             # features/steps/writer.py:118

  Scenario: Check the ability to initialize all database tables                              # features/cli_flags.feature:22
    Given Postgres is running                                                                # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres # features/steps/database.py:65
    And CCX Notification Writer database is not set up                                       # features/steps/database.py:78
    When I start the CCX Notification Writer with the --db-init command line flag            # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                   # features/steps/writer.py:130

  Scenario: Check the ability to perform database cleanup                                    # features/cli_flags.feature:30
    Given Postgres is running                                                                # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres # features/steps/database.py:65
    When I start the CCX Notification Writer with the --db-cleanup command line flag         # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                   # features/steps/writer.py:130

  Scenario: Check the ability to drop all database tables                                    # features/cli_flags.feature:37
    Given Postgres is running                                                                # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres # features/steps/database.py:65
    When I start the CCX Notification Writer with the --db-drop-tables command line flag     # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                   # features/steps/writer.py:130

Feature: Ability to display old records stored in database # features/display_old_records.feature:1

  Scenario: Check the ability to display old records from `new_reports` table if the table is empty.    # features/display_old_records.feature:4
    Given Postgres is running                                                                           # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres            # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                       # features/steps/writer.py:138
    When I select all rows from table new_reports                                                       # features/steps/database.py:102
    Then I should get 0 rows                                                                            # features/steps/database.py:115
    When I close database connection                                                                    # features/steps/database.py:52
    Then I should be disconnected                                                                       # features/steps/database.py:59
    When I start the CCX Notification Writer with the --print-new-reports-for-cleanup command line flag # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                              # features/steps/writer.py:130
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                              # features/steps/writer.py:130

  Scenario: Check the ability to display old records from `reported` table if the table is empty.       # features/display_old_records.feature:18
    Given Postgres is running                                                                           # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres            # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                       # features/steps/writer.py:138
    When I select all rows from table reported                                                          # features/steps/database.py:102
    Then I should get 0 rows                                                                            # features/steps/database.py:115
    When I close database connection                                                                    # features/steps/database.py:52
    Then I should be disconnected                                                                       # features/steps/database.py:59
    When I start the CCX Notification Writer with the --print-old-reports-for-cleanup command line flag # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                              # features/steps/writer.py:130
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                              # features/steps/writer.py:130

  Scenario: Check the ability to display old records from `new_reports` table if the table is not empty and contains old report.  # features/display_old_records.feature:32
    Given Postgres is running                                                                                                     # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                      # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                                 # features/steps/writer.py:138
    And I insert following row into table new_reports                                                                             # features/steps/database.py:124
      | org id | account number | cluster name                         | updated at | kafka offset |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1990-01-01 | 1            |
    When I select all rows from table new_reports                                                                                 # features/steps/database.py:102
    Then I should get 1 rows                                                                                                      # features/steps/database.py:115
    When I close database connection                                                                                              # features/steps/database.py:52
    Then I should be disconnected                                                                                                 # features/steps/database.py:59
    When I start the CCX Notification Writer with the --print-new-reports-for-cleanup command line flag                           # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                        # features/steps/writer.py:130
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                          # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                        # features/steps/writer.py:130

  Scenario: Check the ability to display old records from `new_reports` table if the table is not empty and contains new report.  # features/display_old_records.feature:49
    Given Postgres is running                                                                                                     # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                      # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                                 # features/steps/writer.py:138
    And I insert following row into table new_reports                                                                             # features/steps/database.py:124
      | org id | account number | cluster name                         | updated at | kafka offset |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 2990-01-01 | 1            |
    When I select all rows from table new_reports                                                                                 # features/steps/database.py:102
    Then I should get 1 rows                                                                                                      # features/steps/database.py:115
    When I close database connection                                                                                              # features/steps/database.py:52
    Then I should be disconnected                                                                                                 # features/steps/database.py:59
    When I start the CCX Notification Writer with the --print-new-reports-for-cleanup command line flag                           # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                        # features/steps/writer.py:130
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                          # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                        # features/steps/writer.py:130

  Scenario: Check the ability to display old records from `new_reports` table if the table is not empty and contains old reports.  # features/display_old_records.feature:66
    Given Postgres is running                                                                                                      # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                       # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                                  # features/steps/writer.py:138
    And I insert following rows into table new_reports                                                                             # features/steps/database.py:124
      | org id | account number | cluster name                         | updated at | kafka offset |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1990-01-01 | 1            |
      | 2      | 20             | aaaaaaaa-1f74-4ccf-91af-548dfc9767aa | 1990-01-01 | 2            |
    When I select all rows from table new_reports                                                                                  # features/steps/database.py:102
    Then I should get 2 rows                                                                                                       # features/steps/database.py:115
    When I close database connection                                                                                               # features/steps/database.py:52
    Then I should be disconnected                                                                                                  # features/steps/database.py:59
    When I start the CCX Notification Writer with the --print-new-reports-for-cleanup command line flag                            # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                         # features/steps/writer.py:130
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                           # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                         # features/steps/writer.py:130

  Scenario: Check the ability to display old records from `new_reports` table if the table is not empty and contains new reports.  # features/display_old_records.feature:84
    Given Postgres is running                                                                                                      # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                       # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                                  # features/steps/writer.py:138
    And I insert following rows into table new_reports                                                                             # features/steps/database.py:124
      | org id | account number | cluster name                         | updated at | kafka offset |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 2990-01-01 | 1            |
      | 2      | 20             | aaaaaaaa-1f74-4ccf-91af-548dfc9767aa | 2990-01-01 | 2            |
    When I select all rows from table new_reports                                                                                  # features/steps/database.py:102
    Then I should get 2 rows                                                                                                       # features/steps/database.py:115
    When I close database connection                                                                                               # features/steps/database.py:52
    Then I should be disconnected                                                                                                  # features/steps/database.py:59
    When I start the CCX Notification Writer with the --print-new-reports-for-cleanup command line flag                            # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                         # features/steps/writer.py:130
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                           # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                         # features/steps/writer.py:130

  Scenario: Check the ability to display old records from `new_reports` table if the table is not empty and contains mixed reports.  # features/display_old_records.feature:102
    Given Postgres is running                                                                                                        # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                         # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                                    # features/steps/writer.py:138
    And I insert following rows into table new_reports                                                                               # features/steps/database.py:124
      | org id | account number | cluster name                         | updated at | kafka offset |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1990-01-01 | 1            |
      | 2      | 20             | aaaaaaaa-1f74-4ccf-91af-548dfc9767aa | 2990-01-01 | 2            |
    When I select all rows from table new_reports                                                                                    # features/steps/database.py:102
    Then I should get 2 rows                                                                                                         # features/steps/database.py:115
    When I close database connection                                                                                                 # features/steps/database.py:52
    Then I should be disconnected                                                                                                    # features/steps/database.py:59
    When I start the CCX Notification Writer with the --print-new-reports-for-cleanup command line flag                              # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                           # features/steps/writer.py:130
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                             # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                           # features/steps/writer.py:130

  Scenario: Check the ability to display old records from `reported` table if the table is not empty and contains one old report.  # features/display_old_records.feature:120
    Given Postgres is running                                                                                                      # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                       # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                                  # features/steps/writer.py:138
    And I insert following row into table reported                                                                                 # features/steps/database.py:159
      | org id | account number | cluster name                         | notification type | state | updated at | notified at | error log |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 1990-01-01 | 1990-01-01  |           |
    When I select all rows from table reported                                                                                     # features/steps/database.py:102
    Then I should get 1 rows                                                                                                       # features/steps/database.py:115
    When I close database connection                                                                                               # features/steps/database.py:52
    Then I should be disconnected                                                                                                  # features/steps/database.py:59
    When I start the CCX Notification Writer with the --print-old-reports-for-cleanup command line flag                            # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                         # features/steps/writer.py:130
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                           # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                         # features/steps/writer.py:130

  Scenario: Check the ability to display old records from `reported` table if the table is not empty and contains one new report.  # features/display_old_records.feature:137
    Given Postgres is running                                                                                                      # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                       # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                                  # features/steps/writer.py:138
    And I insert following row into table reported                                                                                 # features/steps/database.py:159
      | org id | account number | cluster name                         | notification type | state | updated at | notified at | error log |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 2990-01-01 | 2990-01-01  |           |
    When I select all rows from table reported                                                                                     # features/steps/database.py:102
    Then I should get 1 rows                                                                                                       # features/steps/database.py:115
    When I close database connection                                                                                               # features/steps/database.py:52
    Then I should be disconnected                                                                                                  # features/steps/database.py:59
    When I start the CCX Notification Writer with the --print-old-reports-for-cleanup command line flag                            # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                         # features/steps/writer.py:130
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                           # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                         # features/steps/writer.py:130

  Scenario: Check the ability to display old records from `reported` table if the table is not empty and contains old reports.  # features/display_old_records.feature:154
    Given Postgres is running                                                                                                   # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                    # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                               # features/steps/writer.py:138
    And I insert following rows into table reported                                                                             # features/steps/database.py:159
      | org id | account number | cluster name                         | notification type | state | updated at | notified at | error log |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 1990-01-01 | 1990-01-01  |           |
      | 2      | 20             | aaaaaaaa-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 1990-01-01 | 1990-01-01  |           |
    When I select all rows from table reported                                                                                  # features/steps/database.py:102
    Then I should get 2 rows                                                                                                    # features/steps/database.py:115
    When I close database connection                                                                                            # features/steps/database.py:52
    Then I should be disconnected                                                                                               # features/steps/database.py:59
    When I start the CCX Notification Writer with the --print-old-reports-for-cleanup command line flag                         # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                      # features/steps/writer.py:130
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                        # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                      # features/steps/writer.py:130

  Scenario: Check the ability to display old records from `reported` table if the table is not empty and contains old reports and contains new reports.  # features/display_old_records.feature:172
    Given Postgres is running                                                                                                                            # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                                             # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                                                        # features/steps/writer.py:138
    And I insert following rows into table reported                                                                                                      # features/steps/database.py:159
      | org id | account number | cluster name                         | notification type | state | updated at | notified at | error log |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 2990-01-01 | 2990-01-01  |           |
      | 2      | 20             | aaaaaaaa-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 2990-01-01 | 2990-01-01  |           |
    When I select all rows from table reported                                                                                                           # features/steps/database.py:102
    Then I should get 2 rows                                                                                                                             # features/steps/database.py:115
    When I close database connection                                                                                                                     # features/steps/database.py:52
    Then I should be disconnected                                                                                                                        # features/steps/database.py:59
    When I start the CCX Notification Writer with the --print-old-reports-for-cleanup command line flag                                                  # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                                               # features/steps/writer.py:130
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                                                 # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                                               # features/steps/writer.py:130

  Scenario: Check the ability to display old records from `reported` table if the table is not empty and contains old reports and contains mixed reports.  # features/display_old_records.feature:190
    Given Postgres is running                                                                                                                              # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                                               # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                                                          # features/steps/writer.py:138
    And I insert following rows into table reported                                                                                                        # features/steps/database.py:159
      | org id | account number | cluster name                         | notification type | state | updated at | notified at | error log |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 1990-01-01 | 1990-01-01  |           |
      | 2      | 20             | aaaaaaaa-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 2990-01-01 | 2990-01-01  |           |
    When I select all rows from table reported                                                                                                             # features/steps/database.py:102
    Then I should get 2 rows                                                                                                                               # features/steps/database.py:115
    When I close database connection                                                                                                                       # features/steps/database.py:52
    Then I should be disconnected                                                                                                                          # features/steps/database.py:59
    When I start the CCX Notification Writer with the --print-old-reports-for-cleanup command line flag                                                    # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                                                 # features/steps/writer.py:130
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                                                   # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                                                 # features/steps/writer.py:130

Feature: Ability to clean up old records stored in database # features/cleanup_old_records.feature:1

  Scenario: Check the ability to clean up old records from `new_reports` table if the table is empty.  # features/cleanup_old_records.feature:4
    Given Postgres is running                                                                          # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres           # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                      # features/steps/writer.py:138
    When I select all rows from table new_reports                                                      # features/steps/database.py:102
    Then I should get 0 rows                                                                           # features/steps/database.py:115
    When I close database connection                                                                   # features/steps/database.py:52
    Then I should be disconnected                                                                      # features/steps/database.py:59
    When I start the CCX Notification Writer with the --new-reports-cleanup command line flag          # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                             # features/steps/writer.py:130
    When CCX Notification Writer database is created for user postgres with password postgres          # features/steps/database.py:65
    And I select all rows from table new_reports                                                       # features/steps/database.py:102
    Then I should get 0 rows                                                                           # features/steps/database.py:115
    When I close database connection                                                                   # features/steps/database.py:52
    Then I should be disconnected                                                                      # features/steps/database.py:59
    When I start the CCX Notification Writer with the --db-drop-tables command line flag               # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                             # features/steps/writer.py:130

  Scenario: Check the ability to clean up old records from `reported` table if the table is empty.  # features/cleanup_old_records.feature:23
    Given Postgres is running                                                                       # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres        # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                   # features/steps/writer.py:138
    When I select all rows from table reported                                                      # features/steps/database.py:102
    Then I should get 0 rows                                                                        # features/steps/database.py:115
    When I close database connection                                                                # features/steps/database.py:52
    Then I should be disconnected                                                                   # features/steps/database.py:59
    When I start the CCX Notification Writer with the --old-reports-cleanup command line flag       # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                          # features/steps/writer.py:130
    When CCX Notification Writer database is created for user postgres with password postgres       # features/steps/database.py:65
    And I select all rows from table reported                                                       # features/steps/database.py:102
    Then I should get 0 rows                                                                        # features/steps/database.py:115
    When I close database connection                                                                # features/steps/database.py:52
    Then I should be disconnected                                                                   # features/steps/database.py:59
    When I start the CCX Notification Writer with the --db-drop-tables command line flag            # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                          # features/steps/writer.py:130

  Scenario: Check the ability to clean up old records from `new_reports` table if the table contains one old report.  # features/cleanup_old_records.feature:42
    Given Postgres is running                                                                                         # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                          # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                     # features/steps/writer.py:138
    And I insert following row into table new_reports                                                                 # features/steps/database.py:124
      | org id | account number | cluster name                         | updated at | kafka offset |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1990-01-01 | 1            |
    When I select all rows from table new_reports                                                                     # features/steps/database.py:102
    Then I should get 1 row                                                                                           # features/steps/database.py:115
    When I close database connection                                                                                  # features/steps/database.py:52
    Then I should be disconnected                                                                                     # features/steps/database.py:59
    When I start the CCX Notification Writer with the --new-reports-cleanup command line flag                         # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                            # features/steps/writer.py:130
    When CCX Notification Writer database is created for user postgres with password postgres                         # features/steps/database.py:65
    And I select all rows from table new_reports                                                                      # features/steps/database.py:102
    Then I should get 0 rows                                                                                          # features/steps/database.py:115
    When I close database connection                                                                                  # features/steps/database.py:52
    Then I should be disconnected                                                                                     # features/steps/database.py:59
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                              # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                            # features/steps/writer.py:130

  Scenario: Check the ability to clean up old records from `new_reports` table if the table contains two old reports.  # features/cleanup_old_records.feature:64
    Given Postgres is running                                                                                          # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                           # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                      # features/steps/writer.py:138
    And I insert following rows into table new_reports                                                                 # features/steps/database.py:124
      | org id | account number | cluster name                         | updated at | kafka offset |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1990-01-01 | 1            |
      | 2      | 20             | aaaaaaaa-1f74-4ccf-91af-548dfc9767aa | 1990-01-01 | 2            |
    When I select all rows from table new_reports                                                                      # features/steps/database.py:102
    Then I should get 2 rows                                                                                           # features/steps/database.py:115
    When I close database connection                                                                                   # features/steps/database.py:52
    Then I should be disconnected                                                                                      # features/steps/database.py:59
    When I start the CCX Notification Writer with the --new-reports-cleanup command line flag                          # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                             # features/steps/writer.py:130
    When CCX Notification Writer database is created for user postgres with password postgres                          # features/steps/database.py:65
    And I select all rows from table new_reports                                                                       # features/steps/database.py:102
    Then I should get 0 rows                                                                                           # features/steps/database.py:115
    When I close database connection                                                                                   # features/steps/database.py:52
    Then I should be disconnected                                                                                      # features/steps/database.py:59
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                               # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                             # features/steps/writer.py:130

  Scenario: Check the ability to clean up old records from `reported` table if the table contains one old report.  # features/cleanup_old_records.feature:87
    Given Postgres is running                                                                                      # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                       # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                  # features/steps/writer.py:138
    And I insert following row into table reported                                                                 # features/steps/database.py:159
      | org id | account number | cluster name                         | notification type | state | updated at | notified at | error log |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 1990-01-01 | 1990-01-01  |           |
    When I select all rows from table reported                                                                     # features/steps/database.py:102
    Then I should get 1 row                                                                                        # features/steps/database.py:115
    When I close database connection                                                                               # features/steps/database.py:52
    Then I should be disconnected                                                                                  # features/steps/database.py:59
    When I start the CCX Notification Writer with the --old-reports-cleanup command line flag                      # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                         # features/steps/writer.py:130
    When CCX Notification Writer database is created for user postgres with password postgres                      # features/steps/database.py:65
    And I select all rows from table reported                                                                      # features/steps/database.py:102
    Then I should get 0 rows                                                                                       # features/steps/database.py:115
    When I close database connection                                                                               # features/steps/database.py:52
    Then I should be disconnected                                                                                  # features/steps/database.py:59
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                           # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                         # features/steps/writer.py:130

  Scenario: Check the ability to clean up old records from `reported` table if the table contains two old reports.  # features/cleanup_old_records.feature:109
    Given Postgres is running                                                                                       # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                        # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                   # features/steps/writer.py:138
    And I insert following rows into table reported                                                                 # features/steps/database.py:159
      | org id | account number | cluster name                         | notification type | state | updated at | notified at | error log |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 1990-01-01 | 1990-01-01  |           |
      | 2      | 20             | aaaaaaaa-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 1990-01-01 | 1990-01-01  |           |
    When I select all rows from table reported                                                                      # features/steps/database.py:102
    Then I should get 2 rows                                                                                        # features/steps/database.py:115
    When I close database connection                                                                                # features/steps/database.py:52
    Then I should be disconnected                                                                                   # features/steps/database.py:59
    When I start the CCX Notification Writer with the --old-reports-cleanup command line flag                       # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                          # features/steps/writer.py:130
    When CCX Notification Writer database is created for user postgres with password postgres                       # features/steps/database.py:65
    And I select all rows from table reported                                                                       # features/steps/database.py:102
    Then I should get 0 rows                                                                                        # features/steps/database.py:115
    When I close database connection                                                                                # features/steps/database.py:52
    Then I should be disconnected                                                                                   # features/steps/database.py:59
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                            # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                          # features/steps/writer.py:130

Feature: Ability to clean up old records stored in database with new records # features/cleanup_new_records.feature:1

  Scenario: Check the ability to clean up old records from `new_reports` table if the table is empty.  # features/cleanup_new_records.feature:4
    Given Postgres is running                                                                          # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres           # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                      # features/steps/writer.py:138
    When I select all rows from table new_reports                                                      # features/steps/database.py:102
    Then I should get 0 rows                                                                           # features/steps/database.py:115
    When I close database connection                                                                   # features/steps/database.py:52
    Then I should be disconnected                                                                      # features/steps/database.py:59
    When I start the CCX Notification Writer with the --new-reports-cleanup command line flag          # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                             # features/steps/writer.py:130
    When CCX Notification Writer database is created for user postgres with password postgres          # features/steps/database.py:65
    And I select all rows from table new_reports                                                       # features/steps/database.py:102
    Then I should get 0 rows                                                                           # features/steps/database.py:115
    When I close database connection                                                                   # features/steps/database.py:52
    Then I should be disconnected                                                                      # features/steps/database.py:59
    When I start the CCX Notification Writer with the --db-drop-tables command line flag               # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                             # features/steps/writer.py:130

  Scenario: Check the ability to clean up old records from `reported` table if the table is empty.  # features/cleanup_new_records.feature:23
    Given Postgres is running                                                                       # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres        # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                   # features/steps/writer.py:138
    When I select all rows from table reported                                                      # features/steps/database.py:102
    Then I should get 0 rows                                                                        # features/steps/database.py:115
    When I close database connection                                                                # features/steps/database.py:52
    Then I should be disconnected                                                                   # features/steps/database.py:59
    When I start the CCX Notification Writer with the --old-reports-cleanup command line flag       # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                          # features/steps/writer.py:130
    When CCX Notification Writer database is created for user postgres with password postgres       # features/steps/database.py:65
    And I select all rows from table reported                                                       # features/steps/database.py:102
    Then I should get 0 rows                                                                        # features/steps/database.py:115
    When I close database connection                                                                # features/steps/database.py:52
    Then I should be disconnected                                                                   # features/steps/database.py:59
    When I start the CCX Notification Writer with the --db-drop-tables command line flag            # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                          # features/steps/writer.py:130

  Scenario: Check the ability to clean up old records from `new_reports` table if the table is not empty.  # features/cleanup_new_records.feature:42
    Given Postgres is running                                                                              # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres               # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                          # features/steps/writer.py:138
    And I insert following row into table new_reports                                                      # features/steps/database.py:124
      | org id | account number | cluster name                         | updated at | kafka offset |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 2990-01-01 | 1            |
    When I select all rows from table new_reports                                                          # features/steps/database.py:102
    Then I should get 1 row                                                                                # features/steps/database.py:115
    When I close database connection                                                                       # features/steps/database.py:52
    Then I should be disconnected                                                                          # features/steps/database.py:59
    When I start the CCX Notification Writer with the --new-reports-cleanup command line flag              # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                 # features/steps/writer.py:130
    When CCX Notification Writer database is created for user postgres with password postgres              # features/steps/database.py:65
    And I select all rows from table new_reports                                                           # features/steps/database.py:102
    Then I should get 1 row                                                                                # features/steps/database.py:115
    When I close database connection                                                                       # features/steps/database.py:52
    Then I should be disconnected                                                                          # features/steps/database.py:59
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                   # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                 # features/steps/writer.py:130

  Scenario: Check the ability to clean up old records from `new_reports` table if the table is not empty and contains two new reports.  # features/cleanup_new_records.feature:64
    Given Postgres is running                                                                                                           # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                            # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                                       # features/steps/writer.py:138
    And I insert following rows into table new_reports                                                                                  # features/steps/database.py:124
      | org id | account number | cluster name                         | updated at | kafka offset |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 2990-01-01 | 1            |
      | 2      | 20             | aaaaaaaa-1f74-4ccf-91af-548dfc9767aa | 2990-01-01 | 2            |
    When I select all rows from table new_reports                                                                                       # features/steps/database.py:102
    Then I should get 2 rows                                                                                                            # features/steps/database.py:115
    When I close database connection                                                                                                    # features/steps/database.py:52
    Then I should be disconnected                                                                                                       # features/steps/database.py:59
    When I start the CCX Notification Writer with the --new-reports-cleanup command line flag                                           # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                              # features/steps/writer.py:130
    When CCX Notification Writer database is created for user postgres with password postgres                                           # features/steps/database.py:65
    And I select all rows from table new_reports                                                                                        # features/steps/database.py:102
    Then I should get 2 rows                                                                                                            # features/steps/database.py:115
    When I close database connection                                                                                                    # features/steps/database.py:52
    Then I should be disconnected                                                                                                       # features/steps/database.py:59
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                                # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                              # features/steps/writer.py:130

  Scenario: Check the ability to clean up old records from `new_reports` table if the table is not empty and contains old and new reports.  # features/cleanup_new_records.feature:87
    Given Postgres is running                                                                                                               # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                                # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                                           # features/steps/writer.py:138
    And I insert following rows into table new_reports                                                                                      # features/steps/database.py:124
      | org id | account number | cluster name                         | updated at | kafka offset |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1990-01-01 | 1            |
      | 2      | 20             | aaaaaaaa-1f74-4ccf-91af-548dfc9767aa | 2990-01-01 | 2            |
    When I select all rows from table new_reports                                                                                           # features/steps/database.py:102
    Then I should get 2 rows                                                                                                                # features/steps/database.py:115
    When I close database connection                                                                                                        # features/steps/database.py:52
    Then I should be disconnected                                                                                                           # features/steps/database.py:59
    When I start the CCX Notification Writer with the --new-reports-cleanup command line flag                                               # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                                  # features/steps/writer.py:130
    When CCX Notification Writer database is created for user postgres with password postgres                                               # features/steps/database.py:65
    And I select all rows from table new_reports                                                                                            # features/steps/database.py:102
    Then I should get 1 row                                                                                                                 # features/steps/database.py:115
    When I close database connection                                                                                                        # features/steps/database.py:52
    Then I should be disconnected                                                                                                           # features/steps/database.py:59
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                                    # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                                  # features/steps/writer.py:130

  Scenario: Check the ability to clean up old records from `reported` table if the table is not empty - contains one new report.  # features/cleanup_new_records.feature:110
    Given Postgres is running                                                                                                     # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                      # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                                 # features/steps/writer.py:138
    And I insert following row into table reported                                                                                # features/steps/database.py:159
      | org id | account number | cluster name                         | notification type | state | updated at | notified at | error log |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 2990-01-01 | 2990-01-01  |           |
    When I select all rows from table reported                                                                                    # features/steps/database.py:102
    Then I should get 1 row                                                                                                       # features/steps/database.py:115
    When I close database connection                                                                                              # features/steps/database.py:52
    Then I should be disconnected                                                                                                 # features/steps/database.py:59
    When I start the CCX Notification Writer with the --old-reports-cleanup command line flag                                     # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                        # features/steps/writer.py:130
    When CCX Notification Writer database is created for user postgres with password postgres                                     # features/steps/database.py:65
    And I select all rows from table reported                                                                                     # features/steps/database.py:102
    Then I should get 1 row                                                                                                       # features/steps/database.py:115
    When I close database connection                                                                                              # features/steps/database.py:52
    Then I should be disconnected                                                                                                 # features/steps/database.py:59
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                          # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                        # features/steps/writer.py:130

  Scenario: Check the ability to clean up old records from `reported` table if the table is not empty and contains only new reports.  # features/cleanup_new_records.feature:132
    Given Postgres is running                                                                                                         # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                          # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                                     # features/steps/writer.py:138
    And I insert following rows into table reported                                                                                   # features/steps/database.py:159
      | org id | account number | cluster name                         | notification type | state | updated at | notified at | error log |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 2990-01-01 | 2990-01-01  |           |
      | 2      | 20             | aaaaaaaa-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 2990-01-01 | 2990-01-01  |           |
    When I select all rows from table reported                                                                                        # features/steps/database.py:102
    Then I should get 2 rows                                                                                                          # features/steps/database.py:115
    When I close database connection                                                                                                  # features/steps/database.py:52
    Then I should be disconnected                                                                                                     # features/steps/database.py:59
    When I start the CCX Notification Writer with the --old-reports-cleanup command line flag                                         # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                            # features/steps/writer.py:130
    When CCX Notification Writer database is created for user postgres with password postgres                                         # features/steps/database.py:65
    And I select all rows from table reported                                                                                         # features/steps/database.py:102
    Then I should get 2 rows                                                                                                          # features/steps/database.py:115
    When I close database connection                                                                                                  # features/steps/database.py:52
    Then I should be disconnected                                                                                                     # features/steps/database.py:59
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                              # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                            # features/steps/writer.py:130

  Scenario: Check the ability to clean up old records from `reported` table if the table is not empty and contains old and new reports.  # features/cleanup_new_records.feature:155
    Given Postgres is running                                                                                                            # features/steps/database.py:25
    And CCX Notification Writer database is created for user postgres with password postgres                                             # features/steps/database.py:65
    And CCX Notification Writer database is empty                                                                                        # features/steps/writer.py:138
    And I insert following rows into table reported                                                                                      # features/steps/database.py:159
      | org id | account number | cluster name                         | notification type | state | updated at | notified at | error log |
      | 1      | 10             | 5d5892d4-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 1990-01-01 | 1990-01-01  |           |
      | 2      | 20             | aaaaaaaa-1f74-4ccf-91af-548dfc9767aa | 1                 | 1     | 2990-01-01 | 2990-01-01  |           |
    When I select all rows from table reported                                                                                           # features/steps/database.py:102
    Then I should get 2 rows                                                                                                             # features/steps/database.py:115
    When I close database connection                                                                                                     # features/steps/database.py:52
    Then I should be disconnected                                                                                                        # features/steps/database.py:59
    When I start the CCX Notification Writer with the --old-reports-cleanup command line flag                                            # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                               # features/steps/writer.py:130
    When CCX Notification Writer database is created for user postgres with password postgres                                            # features/steps/database.py:65
    And I select all rows from table reported                                                                                            # features/steps/database.py:102
    Then I should get 1 row                                                                                                              # features/steps/database.py:115
    When I close database connection                                                                                                     # features/steps/database.py:52
    Then I should be disconnected                                                                                                        # features/steps/database.py:59
    When I start the CCX Notification Writer with the --db-drop-tables command line flag                                                 # features/steps/writer.py:51
    Then the process should exit with status code set to 0                                                                               # features/steps/writer.py:130

5 features passed, 0 failed, 0 skipped
40 scenarios passed, 0 failed, 0 skipped
425 steps passed, 0 failed, 0 skipped, 0 undefined
Took 0m8.006s
